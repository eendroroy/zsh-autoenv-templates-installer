#!/usr/bin/env zsh

function ati_help() {
	echo
	echo "    Usage:"
	echo "        ati help"
	echo "        ati {template_name}"
	echo
	echo "    Example:"
	echo "        ati ruby"
	echo
}

if [[ "$#" -ne 1 ]]; then
	echo
	(>&2 echo "Requires exactly one template name.")
	ati_help
	return 1
fi

if [[ "${1}" == "help" ]]; then
	ati_help
	return 0
fi

SCRIPT_ROOT=${0:A:h}
TEMPLATE_ROOT="${SCRIPT_ROOT}/../autoenv-templates"

source "${TEMPLATE_ROOT}/__TEMPLATE_NAMES.zsh"

if [[ ${__TEMPLATE_NAMES[(i)$1]} > $#__TEMPLATE_NAMES ]]; then
	(>&2 echo "Template for ${1} not available.")
	(>&2 echo "Availavle template are ${__TEMPLATE_NAMES}.")
	return 1
fi

[[ -z ${ATI_ENV_IN} ]]  && ATI_ENV_IN=.env.in
[[ -z ${ATI_ENV_OUT} ]] && ATI_ENV_OUT=.env.out

echo
echo "  ---> Installing template for '${1}' ..."

echo "     > ${1}/env.in > ${ATI_ENV_IN} ..."
\cp "${TEMPLATE_ROOT}/${1}/env.in" "${ATI_ENV_IN}"

echo "     > ${1}/env.out > ${ATI_ENV_OUT} ..."
\cp "${TEMPLATE_ROOT}/${1}/env.out" "${ATI_ENV_OUT}"

echo "  ---> Done installing."

echo
unset SCRIPT_ROOT TEMPLATE_ROOT
